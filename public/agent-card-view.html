<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agent Dossier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
        body {
            background: radial-gradient(circle at top, #020617, #0f172a 60%, #111827 100%);
            min-height: 100vh;
        }
        .info-panel {
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        model-viewer {
            width: 100%;
            height: 400px;
            border-radius: 18px;
            background: radial-gradient(circle at top, #1f2937, #0f172a);
        }
    </style>
</head>
<body class="text-white">
    <div class="max-w-6xl mx-auto px-6 py-12">
        <div class="flex flex-wrap gap-4 mb-8">
            <a href="agent-gallery.html" class="bg-blue-600 hover:bg-blue-700 px-5 py-2 rounded-full flex items-center gap-2 transition">
                <i class="fas fa-arrow-left"></i>
                Back to Gallery
            </a>
            <a href="../index.html" class="bg-slate-700 hover:bg-slate-600 px-5 py-2 rounded-full flex items-center gap-2 transition">
                <i class="fas fa-gamepad"></i>
                Return to Game
            </a>
        </div>

        <div id="profile-content" class="space-y-8 hidden">
            <header class="text-center">
                <p class="text-sm uppercase tracking-[0.4em] text-gray-400">Agent dossier</p>
                <h1 id="agent-name" class="text-5xl font-black mt-4 mb-2"></h1>
                <p id="agent-provider" class="text-gray-400 flex items-center justify-center gap-2">
                    <i class="fas fa-robot text-lg"></i>
                </p>
            </header>

            <section class="grid md:grid-cols-2 gap-8">
                <article class="info-panel rounded-2xl p-6">
                    <h2 class="text-xl font-semibold mb-3 flex items-center gap-2">
                        <i class="fas fa-cube text-blue-400"></i> 3D Character
                    </h2>
                    <div id="model-section"></div>
                </article>

                <article class="info-panel rounded-2xl p-6 space-y-5">
                    <div>
                        <p class="text-xs uppercase tracking-widest text-gray-400">Signature Quote</p>
                        <blockquote id="agent-quote" class="mt-2 text-lg italic border-l-4 pl-4"></blockquote>
                    </div>
                    <div>
                        <p class="text-xs uppercase tracking-widest text-gray-400">Mission Complete</p>
                        <p id="agent-task" class="text-xl mt-2"></p>
                        <p id="agent-date" class="text-gray-400 text-sm mt-1 flex items-center gap-2">
                            <i class="fas fa-calendar"></i>
                        </p>
                    </div>
                    <div class="flex flex-wrap gap-3 text-sm">
                        <span id="agent-color" class="px-3 py-2 rounded-full border border-slate-600"></span>
                        <span id="agent-animal" class="px-3 py-2 rounded-full border border-slate-600"></span>
                    </div>
                </article>
            </section>

            <section class="grid md:grid-cols-2 gap-6">
                <article class="info-panel rounded-2xl p-6">
                    <h3 class="text-lg font-semibold flex items-center gap-2">
                        <i class="fas fa-music text-pink-400"></i> Suno Song Prompt
                    </h3>
                    <p id="suno-prompt" class="mt-3 text-gray-300 leading-relaxed"></p>
                </article>
                <article class="info-panel rounded-2xl p-6">
                    <h3 class="text-lg font-semibold flex items-center gap-2">
                        <i class="fas fa-cube text-emerald-400"></i> Tencent 3D Prompt
                    </h3>
                    <p id="tencent-prompt" class="mt-3 text-gray-300 leading-relaxed"></p>
                </article>
            </section>
        </div>

        <div id="loading-state" class="text-center text-gray-400 mt-20">
            <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
            <p>Loading agent dossier...</p>
        </div>

        <div id="error-state" class="hidden text-center text-red-400 mt-20">
            <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
            <p>Unable to load agent profile.</p>
            <p class="text-sm text-gray-500 mt-2">Check the URL or select another agent from the gallery.</p>
        </div>
    </div>

    <script type="module">
        const params = new URLSearchParams(window.location.search);
        const profileName = params.get('profile');
        const loadingState = document.getElementById('loading-state');
        const errorState = document.getElementById('error-state');
        const profileContent = document.getElementById('profile-content');

        async function fetchProfile(name) {
            if (!name) throw new Error('Missing profile parameter');
            const response = await fetch(`/agents/profiles/${name}`);
            if (!response.ok) throw new Error('Profile not found');
            return response.json();
        }

        function renderProfile(agent) {
            document.getElementById('agent-name').textContent = agent.name;
            document.getElementById('agent-provider').innerHTML =
                `<i class="fas fa-robot text-lg"></i> ${agent.provider}`;
            document.getElementById('agent-quote').textContent = agent.quote || 'Awaiting first log entry.';
            document.getElementById('agent-quote').style.borderColor = agent.favoriteColor || '#38bdf8';
            document.getElementById('agent-task').textContent = agent.taskCompleted || 'Mission pending';
            document.getElementById('agent-date').innerHTML =
                `<i class="fas fa-calendar"></i> ${agent.completedDate || 'YYYY-MM-DD'}`;
            document.getElementById('agent-color').innerHTML =
                `<i class="fas fa-palette mr-2"></i>${agent.favoriteColor || 'n/a'}`;
            document.getElementById('agent-animal').innerHTML =
                `<i class="fas fa-paw mr-2"></i>${agent.favoriteAnimal || 'n/a'}`;
            document.getElementById('suno-prompt').textContent = agent.sunoPrompt?.yourPrompt || 'Not provided';
            document.getElementById('tencent-prompt').textContent = agent.tencent3DPrompt?.yourPrompt || 'Not provided';

            const modelSection = document.getElementById('model-section');
            if (agent.model3D) {
                const modelPath = `/agents/profiles/models/${agent.model3D}`;
                modelSection.innerHTML = `
                    <model-viewer
                        src="${modelPath}"
                        alt="${agent.name} 3D Model"
                        camera-controls
                        auto-rotate
                        shadow-intensity="1"
                        environment-image="neutral"
                        exposure="1"
                        camera-orbit="0deg 75deg 2.5m"
                    >
                        <div slot="poster" class="flex items-center justify-center h-full text-gray-400">
                            <div class="text-center">
                                <i class="fas fa-cube text-4xl mb-2"></i>
                                <p class="text-sm">Loading 3D Model...</p>
                            </div>
                        </div>
                    </model-viewer>
                `;
            } else {
                modelSection.innerHTML = `
                    <div class="h-96 rounded-2xl bg-slate-900 border border-dashed border-slate-600 flex flex-col justify-center items-center gap-3 text-gray-400">
                        <i class="fas fa-user-astronaut text-6xl"></i>
                        <p>No 3D model attached</p>
                        <p class="text-xs text-gray-500">Use the Tencent prompt to generate one.</p>
                    </div>
                `;
            }
        }

        async function init() {
            try {
                const data = await fetchProfile(profileName);
                renderProfile(data);
                loadingState.classList.add('hidden');
                profileContent.classList.remove('hidden');
            } catch (error) {
                console.error(error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
            }
        }

        init();
    </script>
</body>
</html>
